第 10 章　使用 ggtreeExtra 包在
环形布局上呈现数据
10.1　简介
ggtree 包 [1] 能帮助我们对系统发育树及其他树形结构进行可编程的可视化，
也支持将进化树相关数据以多个图层的形式在进化树上直接注释，或者与树并
排绘制（参见本章参考文献 [2]）。虽然 ggtree 包支持以多种布局绘制进化树，
但 geom_facet() 图层函数却仅适用于直角矩形布局、环形布局、椭圆布局及倾斜
布局。而 ggtree 包也没有为环形布局、扇形布局或径向布局外圈数据的呈现提
供直接的支持。为了解决这个问题，我们开发了 ggtreeExtra 包。它能帮助用户
在环形布局树的外圈中绘制相关的图层，并将其与树结构对齐，它也兼容矩形
布局的树。
10.2　基于树的结构将图与树对齐
ggtreeExtra包中的geom_fruit()图层函数用于将外部图层与树结构并排对齐。
与 geom_facet() 图层函数布局类似，geom_fruit() 图层函数可在内部根据树结构
对输入数据进行重新排序，并使用指定的几何对象图层通过美学映射和非变量设
置对数据进行可视化。可视化后生成的图形将显示在树的外圈（环形布局等）或
树的右侧（矩形布局）。
geom_fruit() 图层函数被设计为能够支持 ggplot2 包及其扩展包中定义的大
部分 geom 图层。图的位置（在树外圈上的位置）由 position 参数控制。position
174
参数需要接收一个 position 对象，其默认值为“auto”，此时 geom_fruit() 图层函
数会自行推断并尝试为指定的几何对象图层确定合适的位置。在这个过程中，
geom_fruit() 图层函数会自动对 geom_bar() 图层函数使用 position_stackx() 函数，
对geom_violin()图层函数和geom_boxplot()图层函数使用position_dodgex()函数，
以及对其他的几何图层（如 geom_point() 图层函数和 geom_tile() 图层函数等）
使用 position_identityx() 函数，来调整它们的位置。任何带有 position 参数的几
何图层都可以与 geom_fruit() 图层函数兼容，这就能使在 ggtreeExtra 包中定义的
函数用于调整输出图层的位置。此外，通过 axis.params 和 grid.params 参数，我
们还可以分别为当前的外部图层添加坐标轴和背景网格线。
下面示例使用了 phyloseq 包中的微生物组数据，并使用箱线图来对物种丰
度数据进行可视化。geom_fruit() 图层函数根据环形布局树的结构自动重新排
列丰度数据，并使用特定的 geom() 图层函数（如 geom_boxplot() 图层函数）对
数据进行可视化，如图 10.1 所示。本章参考文献 [2] 中的图 1 就是使用 geom_
density_ridges() 图层函数和 geom_facet() 图层函数对此数据集进行了可视化。
  
