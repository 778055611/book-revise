10 使用ggtreeExtra 在环型布局上呈现数据
10.1 简介
	ggtree包[1]能帮助我们对系统发育树以及其他树形结构进行可编程的可视化。同时，它也支持将进化树相关数据以多个图层的形式在进化树上直接注释，或者是与树并排绘制（另见第 7 章及我们的文章[2]）。虽然ggtree支持以多种布局绘制进化树（参见4.2.2小节），但geom_facet() 图层却仅适用于直角矩形布局、环形布局、椭圆布局及倾斜布局。而ggtree也没有为环形布局、扇形布局或径向布局外圈数据的呈现提供直接的支持。为了解决这个问题，我们开发了ggtreeExtra包，它能帮助用户在环型布局树的外圈中绘制相关的图层，并将其与树结构对齐。同时它也兼容矩形布局的树（如图10.3所示）。

10.2 基于树的结构将图与树对齐
ggtreeExtra包提供了geom_fruit()图层函数，用于将外部图层与树结构并排对齐。与第 7 章中所介绍的 geom_facet() 布局类似，geom_fruit() 可在内部根据树结构对输入数据进行重新排序，并使用指定的几何对象图层通过用户提供的美学映射和非变量设置对数据进行可视化。可视化后生成的图形将显示在树的外圈（环型布局等）或者树的右侧（矩型布局）。

geom_fruit() 被设计为能够支持 ggplot2 及其扩展包中所定义的大部分 geom 图层。图的位置（即在树外圈上的位置）由 position 参数控制。position参数需要接收一个 Position 对象，其默认值是“auto”，此时geom_fruit() 图层函数会自行推断并为尝试所指定的几何对象图层确定合适的位置。在这个过程中，geom_fruit()会自动对geom_bar()使用position_stackx()，对geom_violin() 和 geom_boxplot() 使用position_dodgex()，以及对其他的几何图层使用position_identityx()（如geom_point() 和 geom_tile() 等），来调整他们的位置。任何带有position参数的几何图层都应该可以与geom_fruit()兼容，因为这样就能使在ggtreeExtra 包中定义的位置函数得以调整输出图层的位置。此外，通过使用axis.params 和grid.params 参数，我们还可以分别为当前的外部图层添加坐标轴和背景网格线。

	下例中我们使用phyloseq 包中提供的微生物组数据，并使用箱线图来对物种丰度数据进行可视化。geom_fruit() 图层根据环形树的结构自动重新排列丰度数据，并使用特定的 geom 函数（如geom_boxplot()）将数据可视化，如图10.1所示。我们文章[2]中的图 1还使用geom_density_ridges() 和 geom_facet()对此数据集进行了可视化。
  
  
